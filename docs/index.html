<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kernelcut — Daily Tech Digest</title>
  <meta name="description" content="Kernelcut — Daily Tech Digest. Simple, readable, with long-form summaries and a 06:00 UTC newsletter." />
  <style>
    :root {
      --bg: #ffffff;
      --fg: #111111;
      --muted: #555555;
      --rule: #e6e6e6;
      --maxw: 780px;
    }
    * { box-sizing: border-box; }
    html, body { background: var(--bg); color: var(--fg); margin: 0; padding: 0; }
    body { font: 16px/1.6 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    a { color: inherit; text-decoration: underline; text-underline-offset: 2px; }
    header { max-width: var(--maxw); margin: 28px auto 20px; padding: 0 16px; }
    h1 { margin: 0 0 2px; font-size: 24px; font-weight: 800; }
    .tagline { margin: 2px 0 0; color: var(--muted); font-size: 14px; font-weight: 600; letter-spacing: .02em; }
    .date { margin-top: 4px; color: var(--muted); font-size: 13px; }
    .wrap { max-width: var(--maxw); margin: 0 auto; padding: 0 16px 48px; }
    hr { border: 0; border-top: 1px solid var(--rule); margin: 20px 0; }

    /* newsletter */
    .newsletter { margin-bottom: 24px; text-align: left; }
    .newsletter h2 { font-size: 15px; font-weight: 600; margin: 0 0 8px 0; color: #555; }
    .nl-brevo { display: flex; gap: 8px; align-items: center; max-width: 360px; }
    .nl-brevo input[type="email"]{
      flex: 1; height: 36px; padding: 6px 10px; font-size: 14px;
      border: 1px solid var(--rule); border-radius: 6px; background: #fff; color: var(--fg);
    }
    .nl-brevo button{
      height: 36px; padding: 0 12px; font-weight: 600; cursor: pointer;
      border: 1px solid var(--rule); border-radius: 6px; background: #fff; color: var(--fg);
    }
    .nl-brevo button:hover { background: #f5f5f5; }
    .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0; }

    /* sections and items */
    .section { margin: 26px 0 8px; }
    .section h3 { margin: 0; font-size: 17px; }
    .item { padding: 14px 0; border-bottom: 1px solid var(--rule); }
    .meta { margin-bottom: 6px; color: var(--muted); font-size: 13px; }
    .title { margin: 0 0 8px; font-size: 16px; font-weight: 700; line-height: 1.35; }
    .summary { margin: 0; }
  </style>
</head>
<body>
  <header>
    <h1>Kernelcut</h1>
    <p class="tagline">Daily Tech Digest</p>
    <div class="date" id="digest-date"></div>
  </header>

  <div class="wrap">
    <!-- newsletter -->
    <section class="newsletter" aria-labelledby="nl-title">
      <h2 id="nl-title">06:00 UTC — one concise email per day.</h2>

      <!-- Minimal Brevo POST form (no external CSS/JS, no banners) -->
      <form class="nl-brevo" method="POST"
        action="https://4c375712.sibforms.com/serve/MUIFAP--TDmKcMpec5L78tO0cIgRbArrYaO_9Ef18qgP_uyYkZmLngk_LKCBucmBaIDeXspyhDEyxX4V0mattdBzS1oj5Px1xNOrpzbQi12JVAYYKO7oHLfb7eHQ3cAu7XrtdCtvY6Cxhp2jx48Xz6uQljww40nHgP7nC2azZcuxW22bkZWG_W0bB6zj_K9m9sk4kkTkL3p2ml_r">
        <label class="sr-only" for="EMAIL">Email</label>
        <input id="EMAIL" name="EMAIL" type="email" placeholder="you@domain.com" required />
        <button type="submit">Subscribe</button>

        <!-- Required by Brevo -->
        <input type="text" name="email_address_check" value="" class="sr-only" aria-hidden="true" tabindex="-1" />
        <input type="hidden" name="locale" value="en" />
      </form>
    </section>

    <!-- news sections -->
    <div id="sections" aria-live="polite"></div>
  </div>

  <script>
    // Show today's UTC date
    (function showUTCDate() {
      const iso = new Date().toISOString().slice(0, 10);
      document.getElementById('digest-date').textContent = `${iso} (UTC)`;
    })();

    async function loadFeed() {
      const d = new Date().toISOString().slice(0, 10); // cache-bust
      const res = await fetch(`./playlist.json?d=${d}`, { cache: 'no-store' });
      if (!res.ok) {
        document.getElementById('sections').textContent = 'Failed to load feed.';
        return;
      }
      const items = await res.json();

      const categories = [
        { id: 'bigtech',       name: 'Tech Titans & Upstarts',              emoji: '🚀' },
        { id: 'nextfrontiers', name: 'Next Frontiers (Science & Futurism)', emoji: '🔬' },
        { id: 'code',          name: 'Code & Systems',                      emoji: '💻' },
        { id: 'design',        name: 'Design & Creativity',                 emoji: '🎨' },
        { id: 'ai_data',       name: 'AI & Data Realities',                 emoji: '📊' },
        { id: 'policy',        name: 'Digital Policy & Society',            emoji: '🌍' },
        { id: 'fintech',       name: 'Fintech & Crypto',                    emoji: '💸' },
        { id: 'consumer',      name: 'Consumer Tech & Gadgets',             emoji: '📱' },
        { id: 'space',         name: 'Space & Exploration',                 emoji: '🛰️' }
      ];

      const byCat = items.reduce((acc, it) => {
        (acc[it.category_id] ||= []).push(it);
        return acc;
      }, Object.create(null));

      const $sections = document.getElementById('sections');
      $sections.innerHTML = '';

      const fmtUTC = ts => {
        const d = new Date(ts);
        return new Intl.DateTimeFormat('en-GB', {
          timeZone: 'UTC', hour12: false,
          year: 'numeric', month: '2-digit', day: '2-digit',
          hour: '2-digit', minute: '2-digit'
        }).format(d).replace(/\//g, '-');
      };

      const toHTML = (s = '') =>
        s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')
         .replace(/\n\n+/g, '<br><br>');

      for (const cat of categories) {
        const list = (byCat[cat.id] || [])
          .sort((a,b)=> new Date(b.published_at) - new Date(a.published_at));
        if (!list.length) continue;

        const sec = document.createElement('section');
        sec.className = 'section';
        sec.innerHTML = `<h3>${cat.emoji} ${cat.name}</h3>`;
        $sections.appendChild(sec);

        for (const n of list) {
          const art = document.createElement('article');
          art.className = 'item';

          const metaSource = [cat.emoji + ' ' + cat.name, n.source || '']
            .concat(n.author ? ['— ' + n.author] : [])
            .concat([fmtUTC(n.published_at), n.region || 'Global'])
            .filter(Boolean)
            .join(' • ')
            .replace('• —', '—');

          art.innerHTML = `
            <div class="meta">${metaSource}</div>
            <h4 class="title">
              <a href="${n.url}" target="_blank" rel="noopener noreferrer">${n.title}</a>
            </h4>
            <p class="summary">${toHTML(n.summary_long || '')}</p>
          `;
          $sections.appendChild(art);
        }
      }
    }

    loadFeed();
  </script>
</body>
</html>